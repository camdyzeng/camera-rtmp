---
description: RootEncoder Android æµåª’ä½“åº“ API æ–‡æ¡£ï¼ˆv2.5.2ï¼‰ï¼ŒåŒ…å« RTMP/RTSP/SRT æ¨æµæ¥å£å’Œä»£ç ç¤ºä¾‹
alwaysApply: false
enabled: true
updatedAt: 2025-12-30T10:00:00.000Z
provider: 
---

# RootEncoder Android æµåª’ä½“åº“ API æ–‡æ¡£ (v2.5.2)

> å®˜æ–¹ä»“åº“: https://github.com/pedroSG94/RootEncoder
> ç‰ˆæœ¬: 2.5.2 (2023-10-18)

## âš ï¸ ç‰ˆæœ¬æ³¨æ„äº‹é¡¹

æœ¬æ–‡æ¡£åŸºäº **RootEncoder 2.5.2** ç‰ˆæœ¬ã€‚ä¸åŒç‰ˆæœ¬çš„ API å¯èƒ½æœ‰å·®å¼‚ï¼Œè¯·ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„æ–¹æ³•ç­¾åã€‚

---

## æ¦‚è¿°

RootEncoder æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ Android æµåª’ä½“ç¼–ç å™¨åº“ï¼Œæ”¯æŒå°†éŸ³è§†é¢‘æ¨é€åˆ°åª’ä½“æœåŠ¡å™¨ã€‚

### æ¨¡å—ç»“æ„
| æ¨¡å— | è¯´æ˜ |
|------|------|
| `library` | æ ¸å¿ƒåº“ï¼ŒåŒ…å« GenericCamera2ã€GenericStream ç­‰ |
| `rtmp` | RTMP åè®®å®ç° |
| `rtsp` | RTSP åè®®å®ç° |
| `srt` | SRT åè®®å®ç° (Beta) |
| `udp` | UDP åè®®å®ç° (Beta) |
| `encoder` | ç¼–ç å™¨æ ¸å¿ƒ |
| `common` | é€šç”¨ç»„ä»¶ï¼ŒåŒ…å« ConnectChecker |
| `extra-sources` | é¢å¤–è§†é¢‘æºï¼ˆCameraXã€USBç­‰ï¼‰ |

### æ”¯æŒçš„åè®®å’Œç¼–è§£ç å™¨
| åè®® | çŠ¶æ€ | ç¼–è§£ç å™¨ |
|------|------|----------|
| RTMP | âœ… ç¨³å®š | H264ã€H265ã€AACã€G711 |
| RTSP | âœ… ç¨³å®š | H264ã€H265ã€AACã€G711ã€OPUS |
| SRT | ğŸ”¶ æµ‹è¯•ç‰ˆ | H264ã€H265ã€AACã€OPUS |
| UDP | ğŸ”¶ æµ‹è¯•ç‰ˆ | H264ã€H265ã€AACã€OPUS |

---

## ä¾èµ–é…ç½®

### settings.gradle.kts
```kotlin
dependencyResolutionManagement {
    repositories {
        maven { url = uri("https://jitpack.io") }
    }
}
```

### build.gradle.kts (app)
```kotlin
dependencies {
    // æ ¸å¿ƒåº“ - ä½¿ç”¨ 2.5.2 ç‰ˆæœ¬
    implementation("com.github.pedroSG94.RootEncoder:library:2.5.2")
    
    // å¯é€‰ï¼šé¢å¤–è§†é¢‘æº
    implementation("com.github.pedroSG94.RootEncoder:extra-sources:2.5.2")
}
```

### AndroidManifest.xml æƒé™
```xml
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.RECORD_AUDIO" />
<uses-permission android:name="android.permission.CAMERA" />
<uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
<uses-permission android:name="android.permission.FOREGROUND_SERVICE_CAMERA" />
<uses-permission android:name="android.permission.FOREGROUND_SERVICE_MICROPHONE" />
```

---

## æ ¸å¿ƒç±» API (v2.5.2)

### 1. GenericCamera2 (æ¨èç”¨äºæ‘„åƒå¤´æ¨æµ)

**åŒ…è·¯å¾„**: `com.pedro.library.generic.GenericCamera2`  
**ç»§æ‰¿**: `Camera2Base`  
**è¦æ±‚**: Android API 21+

#### æ„é€ å‡½æ•°
```kotlin
// ä½¿ç”¨ OpenGlViewï¼ˆæ¨èï¼Œæ”¯æŒæ»¤é•œï¼‰
GenericCamera2(openGlView: OpenGlView, connectChecker: ConnectChecker)

// ä½¿ç”¨ Contextï¼ˆæ— é¢„è§ˆï¼Œåå°æ¨æµï¼‰
GenericCamera2(context: Context, connectChecker: ConnectChecker)
```

**âš ï¸ é‡è¦**: v2.5.2 ç‰ˆæœ¬ä¸­ï¼Œé¢„è§ˆé€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥ OpenGlView è®¾ç½®ï¼Œ**ä¸éœ€è¦**è°ƒç”¨ `getGlInterface().setPreview()`ã€‚

#### æ ¸å¿ƒå±æ€§
| å±æ€§ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `isStreaming` | `Boolean` | æ˜¯å¦æ­£åœ¨æ¨æµ |
| `isOnPreview` | `Boolean` | æ˜¯å¦åœ¨é¢„è§ˆ |
| `isRecording` | `Boolean` | æ˜¯å¦åœ¨å½•åˆ¶ |
| `isLanternEnabled` | `Boolean` | é—ªå…‰ç¯æ˜¯å¦å¼€å¯ |
| `isLanternSupported` | `Boolean` | æ˜¯å¦æ”¯æŒé—ªå…‰ç¯ |
| `bitrate` | `Int` | å½“å‰ç ç‡ |
| `streamWidth` | `Int` | æ¨æµå®½åº¦ |
| `streamHeight` | `Int` | æ¨æµé«˜åº¦ |

#### è§†é¢‘é…ç½®æ–¹æ³•

```kotlin
// é»˜è®¤å‚æ•°ï¼š640x480, 30fps, 1200kbps
fun prepareVideo(): Boolean

// è‡ªå®šä¹‰å‚æ•°ï¼ˆæ¨èï¼‰
// âš ï¸ å‚æ•°é¡ºåº: width, height, fps, bitrate, iFrameInterval, rotation
fun prepareVideo(
    width: Int,
    height: Int,
    fps: Int,           // å¸§ç‡ï¼Œå¦‚ 30
    bitrate: Int,       // ç ç‡ï¼ˆbpsï¼‰ï¼Œå¦‚ 4000000
    iFrameInterval: Int,// å…³é”®å¸§é—´éš”ï¼ˆç§’ï¼‰ï¼Œå¦‚ 2
    rotation: Int       // æ—‹è½¬è§’åº¦ï¼Œå¦‚ 0
): Boolean

// è®¾ç½®è§†é¢‘ç¼–ç å™¨ï¼ˆéœ€åœ¨ prepareVideo å‰è°ƒç”¨ï¼‰
fun setVideoCodec(codec: VideoCodec)  // H264, H265
```

**âš ï¸ å¸¸è§é”™è¯¯**: fps å’Œ bitrate å‚æ•°ä½ç½®å®¹æ˜“æ··æ·†ï¼
```kotlin
// âŒ é”™è¯¯ï¼šbitrate å’Œ fps ä½ç½®é¢ å€’
camera.prepareVideo(1920, 1080, 4000000, 30, 2, 0)

// âœ… æ­£ç¡®ï¼šfps åœ¨å‰ï¼Œbitrate åœ¨å
camera.prepareVideo(1920, 1080, 30, 4000000, 2, 0)
```

#### éŸ³é¢‘é…ç½®æ–¹æ³•

```kotlin
// é»˜è®¤å‚æ•°
fun prepareAudio(): Boolean

// è‡ªå®šä¹‰å‚æ•°ï¼ˆæ¨èï¼‰
// âš ï¸ å‚æ•°é¡ºåº: bitrate, sampleRate, isStereo, echoCanceler, noiseSuppressor
fun prepareAudio(
    bitrate: Int,           // ç ç‡ï¼ˆbpsï¼‰ï¼Œå¦‚ 128000
    sampleRate: Int,        // é‡‡æ ·ç‡ï¼Œå¦‚ 44100
    isStereo: Boolean,      // æ˜¯å¦ç«‹ä½“å£°
    echoCanceler: Boolean,  // å›å£°æ¶ˆé™¤
    noiseSuppressor: Boolean // å™ªå£°æŠ‘åˆ¶
): Boolean
```

**âš ï¸ å¸¸è§é”™è¯¯**: å‚æ•°é¡ºåºä¸å…¶ä»–åº“ä¸åŒï¼
```kotlin
// âŒ é”™è¯¯ï¼šsampleRate åœ¨å‰
camera.prepareAudio(44100, true, 128000, false, false)

// âœ… æ­£ç¡®ï¼šbitrate åœ¨å‰
camera.prepareAudio(128000, 44100, true, false, false)
```

#### é¢„è§ˆæ§åˆ¶ (v2.5.2)

**âš ï¸ é‡è¦**: `startPreview` æœ‰å¤šç§é‡è½½ï¼Œæ ¹æ®å®é™…æºç ï¼ˆCamera2Base.javaï¼‰ç¡®è®¤å¦‚ä¸‹ï¼š

```kotlin
// å®Œæ•´çš„ startPreview é‡è½½åˆ—è¡¨ï¼ˆv2.5.2 å®é™…æºç ï¼‰
fun startPreview()                                                              // æ— å‚æ•°
fun startPreview(cameraFacing: CameraHelper.Facing)                             // åªä¼  facing
fun startPreview(cameraId: String)                                              // ä¼ æ‘„åƒå¤´ ID
fun startPreview(width: Int, height: Int)                                       // 2 å‚æ•°
fun startPreview(cameraFacing: CameraHelper.Facing, width: Int, height: Int)    // 3 å‚æ•°
fun startPreview(cameraId: String, width: Int, height: Int)                     // 3 å‚æ•°
fun startPreview(cameraFacing: CameraHelper.Facing, rotation: Int)              // 2 å‚æ•°
fun startPreview(cameraId: String, rotation: Int)                               // 2 å‚æ•°
fun startPreview(cameraFacing: CameraHelper.Facing, width: Int, height: Int, rotation: Int)      // 4 å‚æ•°
fun startPreview(cameraId: String, width: Int, height: Int, rotation: Int)                       // 4 å‚æ•°
fun startPreview(cameraFacing: CameraHelper.Facing, width: Int, height: Int, fps: Int, rotation: Int)  // â­ 5 å‚æ•°ï¼ˆæ¨èï¼‰
fun startPreview(cameraId: String, width: Int, height: Int, fps: Int, rotation: Int)                   // 5 å‚æ•°

// åœæ­¢é¢„è§ˆ
fun stopPreview()

// åœæ­¢ç›¸æœºï¼ˆé‡Šæ”¾èµ„æºï¼‰
fun stopCamera()
```

**âš ï¸ å…³é”®ç‚¹**: `prepareVideo` å’Œ `startPreview` çš„å‚æ•°å¿…é¡»ä¿æŒä¸€è‡´ï¼

```kotlin
// âœ… æ­£ç¡®ï¼šprepareVideo å’Œ startPreview å‚æ•°ä¸€è‡´
val rotation = CameraHelper.getCameraOrientation(context)

// prepareVideo è®¾ç½®ç¼–ç å™¨å‚æ•°
camera.prepareVideo(1920, 1080, 30, 4000000, 2, rotation)

// startPreview è®¾ç½®æ‘„åƒå¤´é‡‡é›†å‚æ•°ï¼ˆå¿…é¡»ä¸ prepareVideo ä¸€è‡´ï¼ï¼‰
camera.startPreview(
    CameraHelper.Facing.BACK,
    1920,   // ä¸ prepareVideo çš„ width ä¸€è‡´
    1080,   // ä¸ prepareVideo çš„ height ä¸€è‡´
    30,     // ä¸ prepareVideo çš„ fps ä¸€è‡´
    rotation // ä¸ prepareVideo çš„ rotation ä¸€è‡´
)

// âŒ é”™è¯¯ï¼šåªä¼  facingï¼Œåˆ†è¾¨ç‡/å¸§ç‡/æ—‹è½¬å¯èƒ½ä¸ prepareVideo ä¸ä¸€è‡´
camera.startPreview(CameraHelper.Facing.BACK)  // å¯èƒ½å¯¼è‡´è§†é¢‘å°ºå¯¸å¼‚å¸¸ï¼
```

**æœ€ä½³å®è·µ**ï¼š
- ä½¿ç”¨ 5 å‚æ•°ç‰ˆæœ¬ `startPreview(facing, width, height, fps, rotation)`
- ç¡®ä¿ä¸ `prepareVideo(width, height, fps, bitrate, iFrameInterval, rotation)` çš„å‚æ•°ä¸€è‡´
- ä¸¤è€…çš„ widthã€heightã€fpsã€rotation å¿…é¡»ç›¸åŒ

#### æ¨æµæ§åˆ¶
```kotlin
// å¼€å§‹æ¨æµï¼ˆéœ€å…ˆè°ƒç”¨ prepareVideo/prepareAudioï¼‰
fun startStream(url: String)

// åœæ­¢æ¨æµ
fun stopStream()
```

#### æ‘„åƒå¤´æ§åˆ¶
```kotlin
// åˆ‡æ¢å‰åæ‘„åƒå¤´
fun switchCamera()
fun switchCamera(cameraId: String)

// é—ªå…‰ç¯
fun enableLantern()
fun disableLantern()

// åŠ¨æ€è°ƒæ•´ç ç‡ï¼ˆæ¨æµä¸­å¯è°ƒç”¨ï¼‰
fun setVideoBitrateOnFly(bitrate: Int)
```

#### éŸ³é¢‘æ§åˆ¶ (v2.5.2)

**âš ï¸ é‡è¦**: v2.5.2 ç‰ˆæœ¬ä¸­**æ²¡æœ‰** `setAudioMuted(boolean)` æ–¹æ³•ï¼Œéœ€ä½¿ç”¨ä»¥ä¸‹æ›¿ä»£æ–¹æ¡ˆï¼š

```kotlin
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ disableAudio/enableAudio
camera.disableAudio()  // é™éŸ³
camera.enableAudio()   // å–æ¶ˆé™éŸ³

// âŒ é”™è¯¯ï¼šsetAudioMuted åœ¨ v2.5.2 ä¸å­˜åœ¨
camera.setAudioMuted(true)  // ç¼–è¯‘é”™è¯¯ï¼
```

#### æ»¤é•œæ§åˆ¶ (v2.5.2)

```kotlin
// è·å– GL æ¥å£
val glInterface = camera.getGlInterface()

// è®¾ç½®æ»¤é•œï¼ˆå‚æ•°ç±»å‹å¿…é¡»æ˜¯ BaseFilterRenderï¼‰
glInterface.setFilter(filter: BaseFilterRender)

// æ·»åŠ å¤šä¸ªæ»¤é•œ
glInterface.addFilter(filter: BaseFilterRender)

// ç§»é™¤æ»¤é•œ
glInterface.removeFilter(index: Int)

// æ¸…ç©ºæ‰€æœ‰æ»¤é•œ
glInterface.clearFilters()
```

#### èµ„æºé‡Šæ”¾ (v2.5.2)

**âš ï¸ é‡è¦**: v2.5.2 ç‰ˆæœ¬ä¸­**æ²¡æœ‰** `release()` æ–¹æ³•ï¼Œéœ€ä½¿ç”¨ä»¥ä¸‹æ–¹å¼é‡Šæ”¾èµ„æºï¼š

```kotlin
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ stopCamera() é‡Šæ”¾èµ„æº
fun releaseCamera() {
    if (camera.isStreaming) camera.stopStream()
    if (camera.isOnPreview) camera.stopPreview()
    camera.stopCamera()  // é‡Šæ”¾ç›¸æœºèµ„æº
}

// âŒ é”™è¯¯ï¼šrelease() åœ¨ v2.5.2 ä¸å­˜åœ¨
camera.release()  // ç¼–è¯‘é”™è¯¯ï¼
```

---

### 2. ConnectChecker æ¥å£

**åŒ…è·¯å¾„**: `com.pedro.common.ConnectChecker`

```kotlin
interface ConnectChecker {
    // å¼€å§‹è¿æ¥
    fun onConnectionStarted(url: String)
    
    // è¿æ¥æˆåŠŸ
    fun onConnectionSuccess()
    
    // è¿æ¥å¤±è´¥
    fun onConnectionFailed(reason: String)
    
    // æ–­å¼€è¿æ¥
    fun onDisconnect()
    
    // è®¤è¯å¤±è´¥
    fun onAuthError()
    
    // è®¤è¯æˆåŠŸ
    fun onAuthSuccess()
    
    // ç ç‡å˜åŒ–
    fun onNewBitrate(bitrate: Long)
}
```

---

## å¯ç”¨æ»¤é•œåˆ—è¡¨ (v2.5.2)

### åŸºç¡€æ»¤é•œ
| æ»¤é•œç±» | è¯´æ˜ | çŠ¶æ€ |
|--------|------|------|
| `NoFilterRender` | æ— æ»¤é•œï¼ˆåŸå§‹ç”»é¢ï¼‰ | âœ… |
| `BaseFilterRender` | åŸºç¡€æ»¤é•œç±»ï¼ˆæŠ½è±¡ç±»ï¼‰ | âœ… |

### é¢œè‰²è°ƒæ•´æ»¤é•œ
| æ»¤é•œç±» | è¯´æ˜ | å¯è°ƒå‚æ•° |
|--------|------|----------|
| `BrightnessFilterRender` | äº®åº¦è°ƒæ•´ | `setBrightness(float)` |
| `ContrastFilterRender` | å¯¹æ¯”åº¦è°ƒæ•´ | `setContrast(float)` |
| `SaturationFilterRender` | é¥±å’Œåº¦è°ƒæ•´ | `setSaturation(float)` |
| `GammaFilterRender` | ä¼½é©¬æ ¡æ­£ | `setGamma(float)` |
| `ExposureFilterRender` | æ›å…‰è°ƒæ•´ | `setExposure(float)` |
| `TemperatureFilterRender` | è‰²æ¸©è°ƒæ•´ | `setTemperature(float)` |
| `ColorFilterRender` | é¢œè‰²æ»¤é•œ | - |
| `RGBSaturationFilterRender` | RGBé¥±å’Œåº¦ | - |

### é£æ ¼æ»¤é•œ
| æ»¤é•œç±» | è¯´æ˜ |
|--------|------|
| `GreyScaleFilterRender` | ç°åº¦æ•ˆæœ |
| `SepiaFilterRender` | æ£•è¤è‰²è°ƒï¼ˆå¤å¤ï¼‰ |
| `NegativeFilterRender` | åè‰²æ•ˆæœ |
| `DuotoneFilterRender` | åŒè‰²è°ƒæ•ˆæœ |
| `EarlyBirdFilterRender` | æ—©é¸Ÿé£æ ¼ |
| `Image70sFilterRender` | 70å¹´ä»£é£æ ¼ |
| `LamoishFilterRender` | Lamoishé£æ ¼ |
| `MoneyFilterRender` | é‡‘é’±é£æ ¼ |

### å›¾åƒå¤„ç†æ»¤é•œ
| æ»¤é•œç±» | è¯´æ˜ |
|--------|------|
| `BeautyFilterRender` | ç¾é¢œæ»¤é•œ |
| `BlurFilterRender` | æ¨¡ç³Šæ•ˆæœ |
| `SharpnessFilterRender` | é”åŒ–æ•ˆæœ |
| `EdgeDetectionFilterRender` | è¾¹ç¼˜æ£€æµ‹ |
| `CartoonFilterRender` | å¡é€šåŒ–æ•ˆæœ |
| `PixelatedFilterRender` | åƒç´ åŒ–æ•ˆæœ |
| `PolygonizationFilterRender` | å¤šè¾¹å½¢åŒ–æ•ˆæœ |

### ç‰¹æ•ˆæ»¤é•œ
| æ»¤é•œç±» | è¯´æ˜ |
|--------|------|
| `AnalogTVFilterRender` | æ¨¡æ‹Ÿç”µè§†æ•ˆæœ |
| `GlitchFilterRender` | æ•…éšœé£æ ¼æ•ˆæœ |
| `SnowFilterRender` | ä¸‹é›ªæ•ˆæœ |
| `FireFilterRender` | ç«ç„°æ•ˆæœ |
| `RainbowFilterRender` | å½©è™¹æ•ˆæœ |
| `ZebraFilterRender` | æ–‘é©¬çº¹æ•ˆæœ |
| `RippleFilterRender` | æ¶Ÿæ¼ªæ•ˆæœ |
| `SwirlFilterRender` | æ¼©æ¶¡æ•ˆæœ |
| `NoiseFilterRender` | å™ªç‚¹æ»¤é•œ |

### å˜å½¢æ»¤é•œ
| æ»¤é•œç±» | è¯´æ˜ |
|--------|------|
| `BasicDeformationFilterRender` | åŸºç¡€å˜å½¢ |
| `CircleFilterRender` | åœ†å½¢é®ç½© |
| `CropFilterRender` | è£å‰ªæ»¤é•œ |
| `RotationFilterRender` | æ—‹è½¬æ•ˆæœ |
| `HalftoneLinesFilterRender` | åŠè‰²è°ƒçº¿æ¡ |

### ç‰¹æ®ŠåŠŸèƒ½æ»¤é•œ
| æ»¤é•œç±» | è¯´æ˜ |
|--------|------|
| `ChromaFilterRender` | è‰²åº¦é”®ï¼ˆç»¿å¹•æŠ å›¾ï¼‰ |
| `BlackFilterRender` | é»‘å±æ»¤é•œ |
| `AndroidViewFilterRender` | Androidè§†å›¾æ»¤é•œ |

### âš ï¸ v2.5.2 ä¸å­˜åœ¨çš„æ»¤é•œ
ä»¥ä¸‹æ»¤é•œåœ¨ v2.5.2 ä¸­**ä¸å­˜åœ¨**ï¼Œè¯·å‹¿ä½¿ç”¨ï¼š
- âŒ `AquaFilterRender`
- âŒ `PosterizeFilterRender`
- âŒ `SharpFilterRender`ï¼ˆä½¿ç”¨ `SharpnessFilterRender` æ›¿ä»£ï¼‰

---

## å®Œæ•´ç¤ºä¾‹ä»£ç  (v2.5.2)

### ç¤ºä¾‹ï¼šä½¿ç”¨å‰å°æœåŠ¡æ¨æµ

```kotlin
class StreamService : Service(), ConnectChecker {
    
    private var camera: GenericCamera2? = null
    private var currentUrl: String = ""
    
    fun initCamera(openGlView: OpenGlView) {
        // ä½¿ç”¨ OpenGlView æ„é€ å‡½æ•°
        camera = GenericCamera2(openGlView, this)
    }
    
    fun startStream(url: String, config: StreamConfig) {
        currentUrl = url
        camera?.let { cam ->
            // âš ï¸ æ³¨æ„å‚æ•°é¡ºåºï¼šwidth, height, fps, bitrate, iFrameInterval, rotation
            val videoPrepared = cam.prepareVideo(
                config.width,
                config.height,
                config.fps,              // fps åœ¨å‰
                config.videoBitrate,     // bitrate åœ¨å
                config.iFrameInterval,
                0
            )
            
            // âš ï¸ æ³¨æ„å‚æ•°é¡ºåºï¼šbitrate, sampleRate, isStereo, echoCanceler, noiseSuppressor
            val audioPrepared = cam.prepareAudio(
                config.audioBitrate,     // bitrate åœ¨å‰
                config.sampleRate,       // sampleRate åœ¨å
                config.isStereo,
                config.echoCanceler,
                config.noiseSuppressor
            )
            
            if (videoPrepared && audioPrepared) {
                cam.startPreview(CameraHelper.Facing.BACK)
                cam.startStream(url)
            }
        }
    }
    
    fun stopStream() {
        camera?.stopStream()
    }
    
    fun toggleMute(mute: Boolean) {
        camera?.let { cam ->
            // âš ï¸ v2.5.2 ä½¿ç”¨ disableAudio/enableAudio
            if (mute) {
                cam.disableAudio()
            } else {
                cam.enableAudio()
            }
        }
    }
    
    fun setFilter(filter: BaseFilterRender) {
        camera?.getGlInterface()?.setFilter(filter)
    }
    
    fun releaseCamera() {
        camera?.let { cam ->
            if (cam.isStreaming) cam.stopStream()
            if (cam.isOnPreview) cam.stopPreview()
            // âš ï¸ v2.5.2 ä½¿ç”¨ stopCamera() è€Œé release()
            cam.stopCamera()
        }
        camera = null
    }
    
    override fun onDestroy() {
        releaseCamera()
        super.onDestroy()
    }
    
    // ConnectChecker å›è°ƒå®ç°
    override fun onConnectionStarted(url: String) { /* ... */ }
    override fun onConnectionSuccess() { /* ... */ }
    override fun onConnectionFailed(reason: String) { /* ... */ }
    override fun onDisconnect() { /* ... */ }
    override fun onAuthError() { /* ... */ }
    override fun onAuthSuccess() { /* ... */ }
    override fun onNewBitrate(bitrate: Long) { /* ... */ }
}

data class StreamConfig(
    val width: Int = 1920,
    val height: Int = 1080,
    val fps: Int = 30,
    val videoBitrate: Int = 4_000_000,
    val audioBitrate: Int = 128_000,
    val sampleRate: Int = 44100,
    val isStereo: Boolean = true,
    val iFrameInterval: Int = 2,
    val echoCanceler: Boolean = false,
    val noiseSuppressor: Boolean = false
)
```

### ç¤ºä¾‹ï¼šæ»¤é•œä½¿ç”¨

```kotlin
// è·å– GL æ¥å£
val glInterface = camera.getGlInterface()

// è®¾ç½®å•ä¸ªæ»¤é•œ
glInterface.setFilter(GreyScaleFilterRender())

// å¯è°ƒå‚æ•°æ»¤é•œ
glInterface.setFilter(ContrastFilterRender().apply { 
    setContrast(1.5f)
})
glInterface.setFilter(BrightnessFilterRender().apply { 
    setBrightness(0.2f)
})
glInterface.setFilter(SharpnessFilterRender().apply { 
    setSharpness(0.5f)  // âš ï¸ ä½¿ç”¨ SharpnessFilterRenderï¼Œä¸æ˜¯ SharpFilterRender
})

// å¤šæ»¤é•œå åŠ 
glInterface.addFilter(BeautyFilterRender())
glInterface.addFilter(ContrastFilterRender())
glInterface.removeFilter(0)  // ç§»é™¤ç¬¬ä¸€ä¸ª
glInterface.clearFilters()   // æ¸…ç©ºæ‰€æœ‰
```

---

## å¸¸ç”¨åˆ†è¾¨ç‡å’Œç ç‡æ¨è

| åˆ†è¾¨ç‡ | æ¨èç ç‡ | å¸§ç‡ | é€‚ç”¨åœºæ™¯ |
|--------|----------|------|----------|
| 3840x2160 (4K) | 15-25 Mbps | 30 | è¶…é«˜æ¸… |
| 1920x1080 | 4-6 Mbps | 30 | é«˜æ¸…ç›´æ’­ |
| 1280x720 | 2-4 Mbps | 30 | æ ‡æ¸…ç›´æ’­ |
| 854x480 | 1-2 Mbps | 30 | æµç•…ç›´æ’­ |
| 640x360 | 500k-1 Mbps | 30 | ä½å¸¦å®½ |

---

## v2.5.2 API å·®å¼‚æ€»ç»“

| åŠŸèƒ½ | v2.6.x+ | v2.5.2 |
|------|---------|--------|
| é™éŸ³æ§åˆ¶ | `setAudioMuted(boolean)` | `disableAudio()` / `enableAudio()` |
| é‡Šæ”¾èµ„æº | `release()` | `stopCamera()` |
| è®¾ç½®é¢„è§ˆ | `getGlInterface().setPreview()` | æ„é€ å‡½æ•°ä¼ å…¥ OpenGlView |
| é”åŒ–æ»¤é•œ | `SharpFilterRender` | `SharpnessFilterRender` |
| Aquaæ»¤é•œ | `AquaFilterRender` | âŒ ä¸å­˜åœ¨ |
| Posterizeæ»¤é•œ | `PosterizeFilterRender` | âŒ ä¸å­˜åœ¨ |

---

## âš ï¸ v2.5.2 ä¸å­˜åœ¨çš„ API æ±‡æ€»

ä»¥ä¸‹ API åœ¨ v2.5.2 ä¸­**ä¸å­˜åœ¨**ï¼Œè¯·å‹¿ä½¿ç”¨ï¼š

| é”™è¯¯ç”¨æ³• | æ­£ç¡®æ›¿ä»£ |
|----------|----------|
| `camera.setAudioMuted(true)` | `camera.disableAudio()` |
| `camera.setAudioMuted(false)` | `camera.enableAudio()` |
| `camera.release()` | `camera.stopCamera()` |
| `SharpFilterRender` | `SharpnessFilterRender` |
| `AquaFilterRender` | âŒ æ— æ›¿ä»£ |
| `PosterizeFilterRender` | âŒ æ— æ›¿ä»£ |

---

## âš ï¸ è§†é¢‘å°ºå¯¸é—®é¢˜æ’æŸ¥

å¦‚æœæ¨æµè§†é¢‘å°ºå¯¸/æ¯”ä¾‹å¼‚å¸¸ï¼ˆå¦‚å›¾åƒç¼©å°åœ¨ä¸­é—´æˆ–é»‘å±ï¼‰ï¼Œæ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

### 1. Context æ¨¡å¼ä¸‹å¿…é¡»é¢„å…ˆäº¤æ¢å®½é«˜å¹¶è®¾ç½® rotation=0ï¼ï¼ˆé‡è¦ï¼‰

**é—®é¢˜æ ¹å› **ï¼šåœ¨ Context æ¨¡å¼ï¼ˆåå°æ¨¡å¼ï¼‰ä¸‹ï¼ŒRootEncoder 2.5.2 å­˜åœ¨ä¸€ä¸ªå°ºå¯¸ä¸åŒ¹é…çš„é—®é¢˜ï¼š

1. `prepareGlView` ä¼šæ ¹æ® rotation äº¤æ¢ `glInterface` çš„å°ºå¯¸
2. ä½† `cameraManager.prepareCamera` ä½¿ç”¨ `videoEncoder.getWidth/Height`ï¼ˆåŸå§‹å€¼ï¼‰
3. è¿™å¯¼è‡´ GL å°ºå¯¸å’Œæ‘„åƒå¤´å°ºå¯¸ä¸åŒ¹é…ï¼Œè§†é¢‘é»‘å±æˆ–ç¼©å°

**è§£å†³æ–¹æ¡ˆ**ï¼šé¢„å…ˆäº¤æ¢å®½é«˜ï¼Œå¹¶è®¾ç½® `rotation=0`

```kotlin
val rotation = CameraHelper.getCameraOrientation(context)

// âš ï¸ å…³é”®ï¼šæ ¹æ® rotation é¢„å…ˆäº¤æ¢å®½é«˜
val (videoWidth, videoHeight) = if (rotation == 90 || rotation == 270) {
    // ç«–å±ï¼šäº¤æ¢å®½é«˜ï¼ˆ1920x1080 å˜æˆ 1080x1920ï¼‰
    settings.videoHeight to settings.videoWidth
} else {
    // æ¨ªå±ï¼šä¿æŒåŸæ ·
    settings.videoWidth to settings.videoHeight
}

// âœ… æ­£ç¡®ï¼šä¼ å…¥äº¤æ¢åçš„å®½é«˜ï¼Œrotation=0
// è¿™æ · videoEncoderã€glInterfaceã€cameraManager ä¸‰è€…å°ºå¯¸ä¸€è‡´
camera.prepareVideo(videoWidth, videoHeight, 30, 4000000, 2, 0)  // rotation=0
camera.startPreview(CameraHelper.Facing.BACK, videoWidth, videoHeight, 30, 0)  // rotation=0

// âŒ é”™è¯¯ï¼šç›´æ¥ä¼ å…¥ç”¨æˆ·è®¾ç½®çš„å®½é«˜å’Œ rotation
camera.prepareVideo(1920, 1080, 30, 4000000, 2, 90)
// ç»“æœï¼š
// - videoEncoder å­˜å‚¨ 1920x1080
// - prepareGlView äº¤æ¢å glInterface è®¾ä¸º 1080x1920
// - cameraManager ä½¿ç”¨ videoEncoder çš„ 1920x1080
// - GL å’Œæ‘„åƒå¤´å°ºå¯¸ä¸åŒ¹é…ï¼Œè§†é¢‘é»‘å±ï¼
```

**åŸç†è¯´æ˜**ï¼š
- è®¾ç½® `rotation=0` åï¼Œ`prepareGlView` ä¸ä¼šäº¤æ¢å®½é«˜
- `glInterface.setEncoderSize` ä½¿ç”¨æˆ‘ä»¬ä¼ å…¥çš„å°ºå¯¸ï¼ˆ1080x1920ï¼‰
- `cameraManager.prepareCamera` ä¹Ÿä½¿ç”¨ç›¸åŒçš„å°ºå¯¸ï¼ˆ1080x1920ï¼‰
- `glInterface.setRotation(0 == 0 ? 270 : 0 - 90)` = 270ï¼ŒGL ä¼šæ—‹è½¬ 270 åº¦
- è¿™æ ·æ‘„åƒå¤´é‡‡é›†çš„æ¨ªå‘æ•°æ®ä¼šè¢«æ­£ç¡®æ—‹è½¬æˆç«–å‘

### 2. prepareVideo å’Œ startPreview å‚æ•°å¿…é¡»ä¸€è‡´

```kotlin
val rotation = CameraHelper.getCameraOrientation(context)
val (w, h) = if (rotation == 90 || rotation == 270) {
    height to width
} else {
    width to height
}

// âœ… æ­£ç¡®ï¼šä¸¤è€…å‚æ•°å®Œå…¨ä¸€è‡´
camera.prepareVideo(w, h, 30, 4000000, 2, rotation)
camera.startPreview(CameraHelper.Facing.BACK, w, h, 30, rotation)
```

### 3. rotation å‚æ•°å¿…é¡»æ­£ç¡®

```kotlin
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ CameraHelper è·å–æ—‹è½¬è§’åº¦
val rotation = CameraHelper.getCameraOrientation(context)

// âŒ é”™è¯¯ï¼šç¡¬ç¼–ç  rotation = 0
camera.prepareVideo(1920, 1080, 30, 4000000, 2, 0)  // ç«–å±æ—¶ä¼šå‡ºé—®é¢˜ï¼
```

### 4. æºç åˆ†æï¼ˆä¸ºä»€ä¹ˆéœ€è¦é¢„å…ˆäº¤æ¢å®½é«˜ï¼‰

åœ¨ `Camera2Base.java` ä¸­ï¼š
```java
// prepareGlView æ–¹æ³•ä¼šäº¤æ¢å®½é«˜ç”¨äº GL æ¸²æŸ“
private void prepareGlView(int width, int height, int rotation) {
    int w = width, h = height;
    if (rotation == 90 || rotation == 270) {
        h = width; w = height;  // äº¤æ¢
    }
    glInterface.setEncoderSize(w, h);  // GL å°ºå¯¸æ­£ç¡®
    // ä½†æ˜¯ï¼æ‘„åƒå¤´ä½¿ç”¨çš„æ˜¯ videoEncoder çš„åŸå§‹å€¼
    cameraManager.prepareCamera(..., videoEncoder.getWidth(), videoEncoder.getHeight(), ...);
    // å¦‚æœ videoEncoder å­˜å‚¨çš„æ˜¯ 1920x1080ï¼Œæ‘„åƒå¤´å°±ä¼šé‡‡é›† 1920x1080
    // ä½† GL æœŸæœ›çš„æ˜¯ 1080x1920ï¼Œå¯¼è‡´å°ºå¯¸ä¸åŒ¹é…ï¼
}
```

---

## å¸¸è§é—®é¢˜

### Q: æ¨æµé»‘å±ï¼Ÿ
- ç¡®è®¤è°ƒç”¨äº† `prepareVideo()` è¿”å› `true`
- ç¡®è®¤è°ƒç”¨äº† `startPreview()`
- æ£€æŸ¥ CAMERA æƒé™
- æ£€æŸ¥ OpenGlView æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–

### Q: æ²¡æœ‰å£°éŸ³ï¼Ÿ
- ç¡®è®¤è°ƒç”¨äº† `prepareAudio()` è¿”å› `true`
- æ£€æŸ¥ RECORD_AUDIO æƒé™
- æ£€æŸ¥æ˜¯å¦è°ƒç”¨äº† `disableAudio()`

### Q: è¿æ¥å¤±è´¥ï¼Ÿ
- æ£€æŸ¥ INTERNET æƒé™
- éªŒè¯ RTMP URL æ ¼å¼ï¼š`rtmp://host/app/streamKey`
- æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨çº¿
- æ£€æŸ¥é˜²ç«å¢™/ç½‘ç»œç­–ç•¥

### Q: ç¼–è¯‘é”™è¯¯ "Unresolved reference"ï¼Ÿ
- æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®ç‰ˆæœ¬çš„ APIï¼ˆå‚è€ƒæœ¬æ–‡æ¡£çš„ v2.5.2 å·®å¼‚æ€»ç»“ï¼‰
- ç¡®è®¤æ»¤é•œç±»åæ­£ç¡®ï¼ˆå¦‚ `SharpnessFilterRender` è€Œé `SharpFilterRender`ï¼‰
- ç¡®è®¤ `startPreview` å‚æ•°æ•°é‡æ­£ç¡®ï¼ˆ**ä¸è¦ç”¨ 5 å‚æ•°ç‰ˆæœ¬**ï¼Œåªæœ‰ 0/1/4 å‚æ•°çš„é‡è½½ï¼‰

---

## ç›¸å…³èµ„æº

- **GitHub**: https://github.com/pedroSG94/RootEncoder
- **Wiki**: https://github.com/pedroSG94/RootEncoder/wiki
- **ç¤ºä¾‹ä»£ç **: https://github.com/pedroSG94/RootEncoder/tree/2.5.2/app
- **æ»¤é•œåˆ—è¡¨**: https://github.com/pedroSG94/RootEncoder/tree/2.5.2/encoder/src/main/java/com/pedro/encoder/input/gl/render/filters
